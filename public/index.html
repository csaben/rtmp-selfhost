<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTMP Self-Host Server</title>
    <script src="https://cdn.jsdelivr.net/npm/flv.js@1.6.2/dist/flv.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .stream-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stream-input {
            margin-bottom: 20px;
        }
        
        .stream-input input {
            width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .stream-input button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .stream-input button:hover {
            background: #0056b3;
        }
        
        #videoPlayer {
            width: 100%;
            max-width: 800px;
            height: 450px;
            background: #000;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
        
        .status {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .status.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .status.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .instructions {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .instructions h3 {
            margin-top: 0;
        }
        
        .production-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .production-toggle button {
            padding: 8px 15px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .production-toggle button:hover {
            background: #5a6268;
        }
        
        .debug-section {
            display: block;
        }
        
        .production-mode .debug-section {
            display: none !important;
        }
        
        .production-mode .header {
            padding: 10px 20px;
        }
        
        .production-mode .header h1 {
            font-size: 24px;
            margin: 0;
        }
        
        .production-mode .header p {
            display: none;
        }
        
        .stream-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stream-grid.grid-1 { grid-template-columns: 1fr; }
        .stream-grid.grid-2 { grid-template-columns: 1fr 1fr; }
        .stream-grid.grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .stream-grid.grid-4 { grid-template-columns: 1fr 1fr; }
        .stream-grid.grid-6 { grid-template-columns: 1fr 1fr 1fr; }
        .stream-grid.grid-9 { grid-template-columns: 1fr 1fr 1fr; }
        
        .stream-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stream-item video {
            width: 100%;
            height: auto;
            min-height: 200px;
            background: #000;
            border-radius: 5px;
        }
        
        .stream-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .stream-controls input {
            flex: 1;
            min-width: 120px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .stream-controls button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        
        .grid-controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .grid-controls h3 {
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            border-left: 4px solid #007bff;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="production-toggle">
        <button onclick="toggleProductionMode()" id="prodToggle">üîß Debug Mode</button>
    </div>
    
    <div class="header">
        <h1>RTMP Self-Host Server</h1>
        <p>Stream from Blue Iris and view your streams here</p>
    </div>
    
    <div class="grid-controls">
        <h3>Stream Grid</h3>
        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
            <label>Streams: 
                <select id="streamCount" onchange="updateGrid()">
                    <option value="1">1 Stream</option>
                    <option value="2">2 Streams</option>
                    <option value="3">3 Streams</option>
                    <option value="4">4 Streams</option>
                    <option value="6">6 Streams</option>
                    <option value="9">9 Streams</option>
                </select>
            </label>
            <button onclick="loadAllStreams()" class="btn-primary">Load All</button>
            <button onclick="stopAllStreams()" class="btn-danger">Stop All</button>
        </div>
    </div>
    
    <div id="streamGrid" class="stream-grid grid-1">
        <!-- Streams will be dynamically added here -->
    </div>
    
    <div id="hardwareInfo" class="debug-section" style="margin-top: 20px;">
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <h4>Hardware Performance:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p><strong>CPU Usage:</strong> <span id="cpuUsage">--</span>%</p>
                    <p><strong>CPU Temp:</strong> <span id="cpuTemp">--</span>¬∞C</p>
                    <p><strong>Memory:</strong> <span id="memoryUsage">--</span> GB / <span id="memoryTotal">--</span> GB (<span id="memoryPercent">--</span>%)</p>
                </div>
                <div>
                    <p><strong>Network RX:</strong> <span id="networkRx">--</span> MB/s</p>
                    <p><strong>Network TX:</strong> <span id="networkTx">--</span> MB/s</p>
                    <p><strong>Disk:</strong> <span id="diskUsed">--</span> GB / <span id="diskTotal">--</span> GB (<span id="diskPercent">--</span>%)</p>
                </div>
            </div>
            <p><strong>Uptime:</strong> <span id="serverUptime">--</span></p>
        </div>
    </div>
    
    <div id="debugInfo" class="debug-section" style="margin-top: 20px;">
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <h4>Debug Information:</h4>
            <p><strong>Server Status:</strong> <span id="serverStatus">Checking...</span></p>
            <p><strong>Active Streams:</strong> <span id="activeStreams">Checking...</span></p>
        </div>
    </div>
    
    <div id="connectionLogs" class="debug-section" style="margin-top: 20px;">
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <h4>Connection Logs:</h4>
            <div id="logContainer" style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                Loading connection logs...
            </div>
            <button onclick="clearLogs()" style="margin-top: 10px; padding: 5px 15px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">Clear Logs</button>
        </div>
    </div>
    
    <div class="instructions debug-section">
        <h3>Blue Iris Configuration</h3>
        <p>To stream from Blue Iris to this server:</p>
        
        <h4>RTMP Settings for Blue Iris:</h4>
        <div class="code" id="rtmpConfig">
            Loading server configuration...
        </div>
        
        <h4>Alternative HTTP Live Stream URL:</h4>
        <div class="code" id="httpStreamUrl">
            Loading...
        </div>
        
        <h4>Network Access:</h4>
        <div class="code" id="networkAccess">
            Loading...
        </div>
    </div>

    <script>
        let serverConfig = null;
        let flvPlayers = {};
        let isProductionMode = false;
        let currentStreamCount = 1;
        
        function updateStatus(message, type = 'warning') {
            const statusDiv = document.getElementById('streamStatus');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }
        
        // Load server configuration
        function loadServerConfig() {
            fetch('/api/config')
                .then(response => response.json())
                .then(config => {
                    serverConfig = config;
                    
                    // Update stream key input
                    document.getElementById('streamKey').value = config.streamKey;
                    
                    // Update configuration displays
                    document.getElementById('rtmpConfig').innerHTML = 
                        `Server URL: ${config.rtmpUrl}<br>Stream Key: ${config.streamKey}`;
                    
                    document.getElementById('httpStreamUrl').innerHTML = 
                        `http://${config.serverIP}:${config.httpApiPort}/live/${config.streamKey}.flv`;
                    
                    document.getElementById('networkAccess').innerHTML = 
                        `Anyone on your network can view at: ${config.webUrl}<br>Local access: http://localhost:${config.webPort}`;
                })
                .catch(err => {
                    console.error('Failed to load server config:', err);
                    document.getElementById('rtmpConfig').textContent = 'Failed to load configuration';
                });
        }
        
        function loadStream() {
            // Use the new FLV player instead of the old method
            loadFlvStream();
        }
        
        function loadFlvStream() {
            const streamKey = document.getElementById('streamKey').value;
            const videoElement = document.getElementById('videoPlayer');
            
            if (!streamKey.trim()) {
                alert('Please enter a stream key');
                return;
            }
            
            if (!serverConfig) {
                alert('Server configuration not loaded. Please wait and try again.');
                return;
            }
            
            updateStatus('Loading FLV stream...', 'warning');
            
            // Stop existing player if any
            if (flvPlayer) {
                flvPlayer.destroy();
                flvPlayer = null;
            }
            
            const streamUrl = `http://${serverConfig.serverIP}:${serverConfig.httpApiPort}/live/${streamKey}.flv`;
            document.getElementById('currentStreamUrl').textContent = streamUrl;
            
            console.log('Loading FLV stream:', streamUrl);
            
            // Check if flv.js is supported
            if (!flvjs.isSupported()) {
                updateStatus('FLV not supported in this browser. Use "Open in VLC" button.', 'error');
                return;
            }
            
            try {
                flvPlayer = flvjs.createPlayer({
                    type: 'flv',
                    url: streamUrl,
                    isLive: true
                });
                
                flvPlayer.attachMediaElement(videoElement);
                flvPlayer.load();
                
                flvPlayer.on(flvjs.Events.LOADING_COMPLETE, () => {
                    updateStatus('Stream loaded, starting playback...', 'warning');
                    flvPlayer.play().catch(e => {
                        console.log('Autoplay prevented, click play button');
                        updateStatus('Stream ready - click play button to start', '');
                    });
                });
                
                flvPlayer.on(flvjs.Events.ERROR, (errorType, errorDetail) => {
                    console.error('FLV Player Error:', errorType, errorDetail);
                    updateStatus(`Stream error: ${errorDetail}. Try "Open in VLC".`, 'error');
                });
                
                flvPlayer.on(flvjs.Events.MEDIA_INFO, (mediaInfo) => {
                    console.log('Media Info:', mediaInfo);
                    updateStatus('Stream is playing successfully!', '');
                });
                
                // Try to start loading
                setTimeout(() => {
                    if (flvPlayer && !videoElement.currentTime) {
                        updateStatus('Stream loading... If nothing appears, use "Open in VLC"', 'warning');
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Failed to create FLV player:', error);
                updateStatus('Failed to create player. Use "Open in VLC" button.', 'error');
            }
        }
        
        function stopStream() {
            if (flvPlayer) {
                flvPlayer.destroy();
                flvPlayer = null;
                updateStatus('Stream stopped', 'warning');
                document.getElementById('videoPlayer').src = '';
            }
        }
        
        // Production mode toggle
        function toggleProductionMode() {
            isProductionMode = !isProductionMode;
            const body = document.body;
            const button = document.getElementById('prodToggle');
            
            if (isProductionMode) {
                body.classList.add('production-mode');
                button.textContent = 'üîß Production Mode';
            } else {
                body.classList.remove('production-mode');
                button.textContent = 'üõ†Ô∏è Debug Mode';
            }
        }
        
        // Update grid layout
        function updateGrid() {
            const streamCount = parseInt(document.getElementById('streamCount').value);
            currentStreamCount = streamCount;
            const grid = document.getElementById('streamGrid');
            
            // Update grid class
            grid.className = `stream-grid grid-${streamCount}`;
            
            // Clear existing streams
            grid.innerHTML = '';
            
            // Create stream items
            for (let i = 1; i <= streamCount; i++) {
                const streamItem = document.createElement('div');
                streamItem.className = 'stream-item';
                streamItem.innerHTML = `
                    <video id="videoPlayer${i}" controls muted>
                        <p>Stream ${i} - Enter key and load</p>
                    </video>
                    <div class="stream-controls">
                        <input type="text" id="streamKey${i}" placeholder="Stream key ${i}" value="blueiris_cam${i}">
                        <button onclick="loadFlvStream(${i})" class="btn-primary">Load</button>
                        <button onclick="openInVLC(${i})" class="btn-success">VLC</button>
                        <button onclick="stopStreamById(${i})" class="btn-danger">Stop</button>
                    </div>
                    <div id="streamStatus${i}" style="margin-top: 5px; font-size: 12px; color: #666;">Ready to load stream ${i}</div>
                `;
                grid.appendChild(streamItem);
            }
        }
        
        // Load FLV stream for specific player
        function loadFlvStream(playerId = 1) {
            const streamKey = document.getElementById(`streamKey${playerId}`).value;
            const videoElement = document.getElementById(`videoPlayer${playerId}`);
            const statusElement = document.getElementById(`streamStatus${playerId}`);
            
            if (!streamKey.trim()) {
                alert(`Please enter a stream key for stream ${playerId}`);
                return;
            }
            
            if (!serverConfig) {
                alert('Server configuration not loaded. Please wait and try again.');
                return;
            }
            
            statusElement.textContent = 'Loading FLV stream...';
            statusElement.style.color = '#ffc107';
            
            // Stop existing player if any
            if (flvPlayers[playerId]) {
                flvPlayers[playerId].destroy();
                delete flvPlayers[playerId];
            }
            
            const streamUrl = `http://${serverConfig.serverIP}:${serverConfig.httpApiPort}/live/${streamKey}.flv`;
            console.log(`Loading FLV stream ${playerId}:`, streamUrl);
            
            // Check if flv.js is supported
            if (!flvjs.isSupported()) {
                statusElement.textContent = 'FLV not supported in this browser. Use VLC button.';
                statusElement.style.color = '#dc3545';
                return;
            }
            
            try {
                const player = flvjs.createPlayer({
                    type: 'flv',
                    url: streamUrl,
                    isLive: true
                });
                
                player.attachMediaElement(videoElement);
                player.load();
                
                player.on(flvjs.Events.LOADING_COMPLETE, () => {
                    statusElement.textContent = 'Stream loaded, starting playback...';
                    player.play().catch(e => {
                        console.log(`Autoplay prevented for stream ${playerId}`);
                        statusElement.textContent = 'Stream ready - click play button';
                        statusElement.style.color = '#28a745';
                    });
                });
                
                player.on(flvjs.Events.ERROR, (errorType, errorDetail) => {
                    console.error(`FLV Player Error ${playerId}:`, errorType, errorDetail);
                    statusElement.textContent = `Stream error: ${errorDetail}`;
                    statusElement.style.color = '#dc3545';
                });
                
                player.on(flvjs.Events.MEDIA_INFO, (mediaInfo) => {
                    console.log(`Media Info ${playerId}:`, mediaInfo);
                    statusElement.textContent = 'Stream playing successfully!';
                    statusElement.style.color = '#28a745';
                });
                
                flvPlayers[playerId] = player;
                
                // Check loading status
                setTimeout(() => {
                    if (player && !videoElement.currentTime) {
                        statusElement.textContent = 'Stream loading... Try VLC if no video appears';
                        statusElement.style.color = '#ffc107';
                    }
                }, 3000);
                
            } catch (error) {
                console.error(`Failed to create FLV player ${playerId}:`, error);
                statusElement.textContent = 'Failed to create player. Use VLC button.';
                statusElement.style.color = '#dc3545';
            }
        }
        
        // Stop specific stream
        function stopStreamById(playerId = 1) {
            if (flvPlayers[playerId]) {
                flvPlayers[playerId].destroy();
                delete flvPlayers[playerId];
                document.getElementById(`streamStatus${playerId}`).textContent = 'Stream stopped';
                document.getElementById(`streamStatus${playerId}`).style.color = '#666';
                document.getElementById(`videoPlayer${playerId}`).src = '';
            }
        }
        
        // Load all streams
        function loadAllStreams() {
            for (let i = 1; i <= currentStreamCount; i++) {
                setTimeout(() => loadFlvStream(i), i * 500); // Stagger loading
            }
        }
        
        // Stop all streams
        function stopAllStreams() {
            Object.keys(flvPlayers).forEach(playerId => {
                stopStreamById(parseInt(playerId));
            });
        }
        
        // Open stream in VLC
        function openInVLC(playerId = 1) {
            if (!serverConfig) {
                alert('Server configuration not loaded yet');
                return;
            }
            
            const streamKey = document.getElementById(`streamKey${playerId}`).value;
            const directUrl = `http://${serverConfig.serverIP}:${serverConfig.httpApiPort}/live/${streamKey}.flv`;
            
            // Copy to clipboard
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = directUrl;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            
            alert(`Stream ${playerId} URL copied to clipboard!\\n\\nTo watch in VLC:\\n1. Open VLC\\n2. Media ‚Üí Open Network Stream\\n3. Paste: ${directUrl}\\n4. Click Play\\n\\nOr try opening directly:`);
            window.open(directUrl, '_blank');
        }
        
        // Check server status and streams
        function checkServerStatus() {
            fetch('/api/streams')
                .then(response => {
                    if (response.ok) {
                        document.getElementById('serverStatus').textContent = 'Online';
                        return response.json();
                    } else {
                        throw new Error('Server not responding');
                    }
                })
                .then(data => {
                    console.log('Server response:', data);
                    document.getElementById('activeStreams').textContent = 
                        Object.keys(data).length > 0 ? JSON.stringify(data) : 'None';
                })
                .catch(err => {
                    document.getElementById('serverStatus').textContent = 'Error: ' + err.message;
                    document.getElementById('activeStreams').textContent = 'Unable to check';
                    console.error('Server check failed:', err);
                });
        }
        
        // Load and display connection logs
        function loadConnectionLogs() {
            fetch('/api/logs')
                .then(response => response.json())
                .then(data => {
                    const logContainer = document.getElementById('logContainer');
                    
                    if (data.logs.length === 0) {
                        logContainer.innerHTML = '<div style="color: #666;">No connection attempts yet...</div>';
                        return;
                    }
                    
                    const logHTML = data.logs.map(log => {
                        const time = new Date(log.timestamp).toLocaleTimeString();
                        const typeColor = getLogTypeColor(log.type);
                        const streamInfo = log.data.streamPath ? ` (${log.data.streamPath})` : '';
                        
                        return `<div style="margin-bottom: 5px; padding: 3px; border-left: 3px solid ${typeColor}; padding-left: 8px;">
                            <span style="color: #666;">[${time}]</span> 
                            <strong style="color: ${typeColor};">${log.type.toUpperCase()}</strong>: 
                            ${log.message}${streamInfo}
                        </div>`;
                    }).join('');
                    
                    logContainer.innerHTML = logHTML;
                    
                    // Auto-scroll to bottom for new logs
                    logContainer.scrollTop = logContainer.scrollHeight;
                })
                .catch(err => {
                    document.getElementById('logContainer').innerHTML = 
                        '<div style="color: #dc3545;">Failed to load logs: ' + err.message + '</div>';
                });
        }
        
        // Get color for log types
        function getLogTypeColor(type) {
            const colors = {
                'system': '#28a745',
                'connection': '#007bff', 
                'stream': '#ffc107',
                'viewer': '#17a2b8',
                'error': '#dc3545'
            };
            return colors[type] || '#666';
        }
        
        // Clear logs function
        function clearLogs() {
            if (confirm('Clear all connection logs?')) {
                fetch('/api/logs', { method: 'DELETE' })
                    .then(() => loadConnectionLogs())
                    .catch(err => console.error('Failed to clear logs:', err));
            }
        }
        
        // Try opening direct stream URL (now for VLC)
        function tryDirectURL() {
            if (!serverConfig) {
                alert('Server configuration not loaded yet');
                return;
            }
            
            const streamKey = document.getElementById('streamKey').value;
            const directUrl = `http://${serverConfig.serverIP}:${serverConfig.httpApiPort}/live/${streamKey}.flv`;
            
            updateStatus('Opening stream URL for VLC...', 'warning');
            
            // Create a temporary link to copy URL
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = directUrl;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            
            alert(`Stream URL copied to clipboard!\n\nTo watch in VLC:\n1. Open VLC\n2. Media ‚Üí Open Network Stream\n3. Paste: ${directUrl}\n4. Click Play\n\nOr try opening directly:`);
            window.open(directUrl, '_blank');
        }
        
        // Auto-load default stream on page load
        window.onload = function() {
            loadServerConfig();
            checkServerStatus();
            loadConnectionLogs();
            
            // Initialize grid layout
            updateGrid();
            
            // Load initial hardware stats
            loadHardwareStats();
            
            // Wait for config to load
            setTimeout(() => {
                if (serverConfig) {
                    // Auto-load first stream in production mode
                    if (isProductionMode) {
                        loadFlvStream(1);
                    }
                }
            }, 1000);
        };
        
        // Load hardware performance
        function loadHardwareStats() {
            fetch('/api/performance')
                .then(response => response.json())
                .then(data => {
                    const stats = data.current;
                    
                    // Update CPU stats
                    document.getElementById('cpuUsage').textContent = stats.cpu.usage || '--';
                    document.getElementById('cpuTemp').textContent = stats.cpu.temp || '--';
                    
                    // Update memory stats
                    document.getElementById('memoryUsage').textContent = stats.memory.used || '--';
                    document.getElementById('memoryTotal').textContent = stats.memory.total || '--';
                    document.getElementById('memoryPercent').textContent = stats.memory.percent || '--';
                    
                    // Update network stats
                    document.getElementById('networkRx').textContent = stats.network.rx || '--';
                    document.getElementById('networkTx').textContent = stats.network.tx || '--';
                    
                    // Update disk stats
                    document.getElementById('diskUsed').textContent = stats.disk.used || '--';
                    document.getElementById('diskTotal').textContent = stats.disk.total || '--';
                    document.getElementById('diskPercent').textContent = stats.disk.percent || '--';
                    
                    // Update uptime
                    const uptimeMinutes = Math.floor(data.uptime / 60);
                    const uptimeHours = Math.floor(uptimeMinutes / 60);
                    const uptimeDisplay = uptimeHours > 0 ? 
                        `${uptimeHours}h ${uptimeMinutes % 60}m` : 
                        `${uptimeMinutes}m`;
                    document.getElementById('serverUptime').textContent = uptimeDisplay;
                    
                    // Color code high usage
                    const cpuElement = document.getElementById('cpuUsage');
                    const memElement = document.getElementById('memoryPercent');
                    
                    if (stats.cpu.usage > 80) {
                        cpuElement.style.color = '#dc3545'; // Red
                    } else if (stats.cpu.usage > 60) {
                        cpuElement.style.color = '#ffc107'; // Yellow
                    } else {
                        cpuElement.style.color = '#28a745'; // Green
                    }
                    
                    if (stats.memory.percent > 85) {
                        memElement.style.color = '#dc3545'; // Red
                    } else if (stats.memory.percent > 70) {
                        memElement.style.color = '#ffc107'; // Yellow
                    } else {
                        memElement.style.color = '#28a745'; // Green
                    }
                })
                .catch(err => {
                    console.error('Failed to load hardware stats:', err);
                });
        }
        
        // Check for active streams and update logs periodically
        setInterval(() => {
            checkServerStatus();
            loadConnectionLogs();
            loadHardwareStats();
        }, 5000); // Reduced to 5 seconds to include hardware stats
    </script>
</body>
</html>